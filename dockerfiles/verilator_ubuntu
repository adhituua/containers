ARG IMAGE="ubuntu:bionic"

FROM $IMAGE AS build-verilator

# Verilator (version 3.9+ required, in general apt-get will give 3.8)
RUN apt update && apt install -y \
  autoconf \
  g++ \
  flex \
  bison

RUN mkdir -p $WORKDIR/tools && cd $WORKDIR/tools \
 && git clone http://git.veripool.org/git/verilator \
 && cd verilator \
 && unset VERILATOR_ROOT \
 && autoconf \
 && ./configure --prefix="/usr/local/"\
 && make -j$(nproc) \
 && make install DESTDIR="$(pwd)/install-verilator" \
 && mv install-verilator/usr/local /tmp/verilator
